# Взаимодействие с сервером

События клиента, информация о которых отсылается на сервер (пока только постройка / снос зданий):

- Запрос состояния (`StateRequestEvent`) &mdash; игрок запрашивает информацию об игре. Сервер возвращает всё состояние игры;
- Запрос обновления (`UpdateRequestEvent`) &mdash; игрок запрашивает изменения состояния от сервера. Сервер возращает все изменения состояния игры;
- Постройка здания (`BuildEvent`) &mdash; игрок строит какое-либо здание. Сервер возвращает результат постройки (успешность или неуспешность) и уведомляет других игроков о новом здании;
- Снос здания (`DestroyEvent`) &mdash; игрок сносит какое-либо здание. Сервер возвращает сноса (успешность или неуспешность) и уведомляет других игроков о сносе.

Отношения объектов игры (очень предварительный вариант):

- Игрок **(1..*)**
  - Ресурсы **(1)**
  - Энергия **(1)**
  - Здание **(1..*)**
    - Координаты **(1)**
    - Данные здания **(1)** (для каждого вида здания данные разные)
  - Единица техники **(0..*)**
    - Координаты **(1)**
    - Данные единицы **(1)** (для каждого вида единицы техники данные разные)

## Структура игры

Тип `Building`:

```
{
  "x": "<int>",
  "y": "<int>"
}
```

Тип `CommandCenter`: `Building`.

Тип `Beacon`: `Building`.

Тип `ResearchCenter`: `Building`.

Тип `Turret`: `Building`.

Тип `Generator`: `Building`.

Тип `Mine`: `Building`.

Тип `Hangar`: `Building`.

Тип `Color`:

```
{
  "r": "<int>",
  "g": "<int>",
  "b": "<int>"
}
```

Тип `GameState`:

```
{
  "resources": "<int>",
  "energy": "<int>",
  "playerId": "<int>",
  "playerIndex": "<int>",
  "players": [
    {
      "name": "<String>",
      "color": "<Color>",
      "commandCenter": "<CommandCenter>",
      "beacons": ["<Beacon>"],
      "researchCenters": ["<ResearchCenter>],
      "turrets": ["<Turret>"],
      "generators": ["<Generator>"],
      "mines": ["<Mine>"],
      "hangars": ["<Hangar>"]
    }
  ]
}
```

## StateRequestEvent

**Клиент -> Сервер**: ничего.

**Сервер -> Клиент**:
- данные об игре (структура показана выше).

## UpdateRequestEvent

**Клиент -> Сервер**: ничего

**Сервер -> Клиент**:
- изменения игрового состояния, которые нужно передать игроку.

**Дополнительные действия**: очередь обновлений для игрока очищается.

## BuildEvent

`BuildEvent` совершает также действия `UpdateRequestEvent`.

**Клиент -> Сервер**:
- тип здания;
- координаты постройки.

**Сервер -> Клиент**:
- результат постройки;
- изменения игрового состояния, которые нужно передать игроку (в подарок).

**Дополнительные действия**:
- игроки уведомляются о новом здании;
- очередь обновлений для игрока очищается.

## DestroyEvent

`DestroyEvent` совершает также действия `UpdateRequestEvent`.

**Клиент -> Сервер**:
- здание (в виде идентификатора (но я не уверен));

**Сервер -> Клиент**:
- результат сноса;
- изменения игрового состояния, которые нужно передать игроку.

**Дополнительные действия**:
- игроки уведомляются о сносе здания;
- очередь обновлений для игрока очищается.

## Изменения игрового состояния

Здание построено (`BuildingBuilt`):

```
{
  "type": "BuildingBuilt",
  "playerIndex": "<int>",
  "buildingType": "<String>",
  "x": "<int>",
  "y": "<int>"
}
```

Здание разрушено (`BuildingDestroyed`):

```
{
  "type": "BuildingDestroyed`,
  "playerIndex": "<int>",
  "buildingType": "<String>",
  "buildingIndex: "<int>"
}
```
